<script type="text/html" data-help-name="DBEngine">
     <p><b>数据库连接设置</b></p>
     <ul>
        <li>连接 TDengine 数据库使用 WEBSOCKET 协议。</li>
        <li>连接 TDengine 云服务可使用“连接字符串”类型。</li>
        <li>连接密码不暴露可选择“主机/端口”类型。</li>
        <li>连接各属性详细参考： 
            <a href="https://docs.taosdata.com/reference/connector/node/#url-%E8%A7%84%E8%8C%83" target="_blank">
                URL 规范
            </a>
        </li>
     </ul>
</script>

<script type="text/html" data-help-name="tdengine">
    <p><b>TDengine 数据库操作节点</b></p>
    <p>提供 SQL 执行接口，支持 TDengine 数据写入与查询操作。</p>

    <h3>功能特性</h3>
    <ul>
        <li>支持本地部署及云服务的 TDengine 数据源。</li>
        <li>支持 TDengine 所有 SQL 操作（SELECT/INSERT/CREATE/ALTER/SHOW等）。</li>
        <li>统一接口处理读写操作（<code>msg.topic</code>传递 SQL 语句）。</li>
        <li>自动识别查询类（SELECT/SHOW/DESC/EXPLAIN）与写入类操作。</li>
    </ul>

    <h3>节点状态</h3>
    <ul>
        <li>连接中 (灰色)</li>
        <li>工作正常 (绿色)</li>
        <li>工作异常 (红色)</li>
    </ul>

    <h3>输入格式</h3>
    <pre><code class="javascript">
msg = {
  topic: "SQL语句",  // 必需字段
  payload: { ... }  // 未使用
}
    </code></pre>
    <p>SQL 特殊字符与转义符需遵循 JSON 字符串规范</p>

    <h3>输出格式</h3>
    <p> payload 输出对象数组，对象属性名与查询返回字段名一致，对象属性数据类型与数据库字段类型映射关系参考：</p>
    <p>
        <a href="https://docs.taosdata.com/reference/connector/node/" target="_blank">
            TDengine NodeJS 连接器类型映射表
        </a>
    </p>
    <pre><code class="javascript">{
topic: "原始 SQL",
payload: [
  { ts: 1749609744000, current: 20, voltage: 200, phase: 5 },
  { ts: 1749609200001, current: 31, voltage: 210, phase: 4 },
    ...
]}</code></pre>

    <h3>错误处理</h3>
    <ul>
        <li>操作失败时自动抛出异常（不向下游传递 msg）</li>
        <li>使用 catch 节点捕获处理错误</li>
        <li>错误日志包含完整错误对象及 TDengine 原生错误码</li>
        <li>发生错误时节点状态变更为 <code>工作异常</code></li>
    </ul>

    <h3>日志配置</h3>
    日志级别，遵循 node-red 日志级别开启不同 Level 上日志
    <pre><code class="json">// settings.js
logging: {
level: "info"  // 支持: fatal, error, warn, info, debug, trace, off
}</code></pre>
    <ul>
        <li>日志格式: [时间] [节点名] 首字母大写的英文描述</li>
        <li>支持级别: error, warn, info, debug</li>
    </ul>

    <h3>使用示例</h3>
    <div class="node-help-examples">
        <p><b>写入数据：</b></p>
        <pre><code class="javascript">msg.topic = "INSERT INTO meters 
               VALUES (NOW, 10.2, 219, 0.32)";</code></pre>

        <p><b>查询数据：</b></p>
        <pre><code class="javascript">msg.topic = "SELECT * FROM meters 
               WHERE voltage > 220";</code></pre>
    </div>
</script>
